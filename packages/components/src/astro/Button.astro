---
import { Icon } from "astro-icon";
import type { HTMLTag, HTMLAttributes } from "astro/types";
import { useLink } from "@cieloazul310/astro-sarkara-utils";
import {
  css,
  cx,
  sva,
  type RecipeVariantProps,
} from "@cieloazul310/sarkara-css/css";
/** @todo recipes for astro problem */
/*
import {
  buttonBase,
  button,
  type ButtonBaseVariantProps,
  type ButtonVariantProps,
} from "@cieloazul310/sarkara-css/recipes";
*/

const button = sva({
  slots: ["button", "icon"],
  base: {
    button: {
      rounded: "md",
      display: "inline-flex",
      alignItems: "center",
      justifyContent: "center",
      shadow: "sm",
      cursor: "pointer",
      width: "fit-content",
      py: 2,
      px: "0.8em",
    },
    icon: {
      width: "1.2em",
      height: "1.2em",
    },
  },
  variants: {
    visual: {
      solid: {
        button: {
          bg: { base: "colorPalette.600", _hover: "colorPalette.700" },
          color: "white",
          _dark: {
            bg: { base: "colorPalette.700", _hover: "colorPalette.600" },
          },
        },
      },
      outline: {
        button: {
          borderWidth: "1px",
          borderColor: { base: "colorPalette.700", _dark: "colorPalette.200" },
          color: { base: "colorPalette.700", _dark: "colorPalette.200" },
          _hover: {
            color: { base: "colorPalette.500", _dark: "colorPalette.50" },
          },
        },
      },
    },
    size: {
      sm: { button: { fontSize: "xs", gap: 1 } },
      md: { button: { fontSize: "md", gap: 1 } },
      lg: { button: { fontSize: "xl", gap: 1 } },
      xl: { button: { fontSize: "4xl", gap: 2 } },
    },
    iconPlace: {
      start: {
        button: {
          flexDirection: "row",
        },
        icon: {
          ml: "-0.4em",
        },
      },
      end: {
        button: {
          flexDirection: "row-reverse",
        },
        icon: {
          mr: "-0.4em",
        },
      },
    },
  },
  defaultVariants: {
    visual: "solid",
    size: "md",
    iconPlace: "start",
  },
});

type ButtonVariants = RecipeVariantProps<typeof button>;

/** @todo recipes for astro problem */
// type ButtonVariants = ButtonBaseVariantProps & ButtonVariantProps;

export type Props<T extends HTMLTag> = ButtonVariants &
  HTMLAttributes<T> & {
    as?: T;
    className?: string;
    colorPalette?: string;
    icon?: string;
  };
const {
  visual,
  size,
  iconPlace,
  className,
  icon,
  as = "button",
  colorPalette = "neutral",
  ...props
} = Astro.props;

const classes = button({ iconPlace, size, visual });
const Element = as;
const link = as === "a" ? useLink(props.href) : {};
---

<Element
  class={cx(
    css({ colorPalette }),
    /** @todo recipes for astro problem */
    // buttonBase({ visual, size }),
    classes.button,
    className,
  )}
  {...props}
  {...link}
>
  {icon && <Icon name={icon} class={classes.icon} />}
  <slot />
</Element>
